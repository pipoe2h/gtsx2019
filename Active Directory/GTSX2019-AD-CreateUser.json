{"status":{},"spec":{"description":"","resources":{"client_attrs":{"8052b5ae_deployment":{"y":313,"x":492}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"ActiveDirectory"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"b2ab6c82_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"6dc3c27e_runbook","main_task_local_reference":{"kind":"app_task","name":"b2ab6c82_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"ActiveDirectory"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"4d52c0d0_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"b596959d_runbook","main_task_local_reference":{"kind":"app_task","name":"4d52c0d0_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"ActiveDirectory"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"fe61c89f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"6f0ee764_runbook","main_task_local_reference":{"kind":"app_task","name":"fe61c89f_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"ActiveDirectory"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"cdb26ff1_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"035086a4_runbook","main_task_local_reference":{"kind":"app_task","name":"cdb26ff1_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"ActiveDirectory"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ae9d127b_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"6c9aed52_runbook","main_task_local_reference":{"kind":"app_task","name":"ae9d127b_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"ActiveDirectory","port_list":[],"tier":"","variable_list":[{"val_type":"STRING","description":"","name":"AD_USERNAME","type":"LOCAL","value":"","label":"","attrs":{"type":""}},{"val_type":"STRING","description":"","name":"AD_GROUPS","type":"LOCAL","value":"","label":"","attrs":{"type":""}}],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"EXISTING_VM","name":"DomainController","readiness_probe":{"connection_type":"POWERSHELL","retries":"5","disable_readiness_probe":false,"address":"@@{ip_address}@@","delay_secs":"60","connection_port":5985,"login_credential_local_reference":{"kind":"app_credential","name":"calm_ad_svc_account"}},"os_type":"Windows","create_spec":{"type":"PROVISION_EXISTING_MACHINE","address":"@@{DC_ADDRESS}@@"},"variable_list":[]}],"credential_definition_list":[{"username":"administrator@gtsx.local","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"calm_ad_svc_account","editables":{"username":true,"secret":true}}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"ActiveDirectory"}],"name":"AD_PACKAGE","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AD_PACKAGE"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"GenerateUserName"},{"kind":"app_task","name":"CreateUser"},{"kind":"app_task","name":"UpdateService"}],"name":"ca5a012c_dag","state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"GenerateUserName"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"CreateUser"}},{"from_task_reference":{"kind":"app_task","name":"CreateUser"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"UpdateService"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"ActiveDirectory"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"GenerateUserName","state":"ACTIVE","attrs":{"exit_status":[],"script":"$UserName = \"@@{AD_NAME}@@.@@{AD_SURNAME}@@\"\n\nWrite-Host AD_USERNAME = $UserName","eval_variables":["AD_USERNAME"],"eval_scope":"local","type":"","script_type":"npsscript"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"ActiveDirectory"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"CreateUser","state":"ACTIVE","attrs":{"script":"$UserName = \"@@{AD_USERNAME}@@\"\n$PlainPassword = \"@@{AD_PASSWORD}@@\"\n$SecurePassword = $PlainPassword | ConvertTo-SecureString -AsPlainText -Force\n$AdminGroup = \"@@{AD_ADMIN_GROUP}@@\"\n\nNew-ADUser -Name \"@@{AD_NAME}@@ @@{AD_SURNAME}@@\" -Description \"Calm - Created by @@{calm_username}@@\" -SamAccountName $UserName -GivenName \"@@{AD_NAME}@@\" -Surname \"@@{AD_SURNAME}@@\" -EmailAddress \"@@{AD_EMAIL}@@\" -UserPrincipalName \"$UserName@@@{AD_DOMAIN}@@\" -AccountPassword $SecurePassword -PasswordNeverExpires $true -Path \"@@{AD_OU}@@\" -Enabled $true\n\n$IsAdmin = \"@@{AD_ADMIN}@@\"\nif ($IsAdmin){\n\tAdd-ADGroupMember -Identity $AdminGroup -Members $UserName\n}","type":"","command_line_args":"","exit_status":[],"script_type":"npsscript"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"ActiveDirectory"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"UpdateService","state":"ACTIVE","attrs":{"exit_status":[],"script":"$IsAdmin = \"@@{AD_ADMIN}@@\"\n\nif ($isAdmin){\n\tWrite-Host AD_GROUPS = \"@@{AD_ADMIN_GROUP}@@\"\n}","eval_variables":["AD_GROUPS"],"eval_scope":"local","type":"","script_type":"npsscript"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]}],"description":"","name":"2eab9362_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"ca5a012c_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AD_PACKAGE"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"DeleteUser"}],"name":"6802c515_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"ActiveDirectory"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"DeleteUser","state":"ACTIVE","attrs":{"script":"$UserName = \"@@{AD_NAME}@@.@@{AD_SURNAME}@@\"\n\nRemove-ADUser -Identity $UserName -Confirm:$false","type":"","command_line_args":"","exit_status":[],"script_type":"npsscript"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"eac422f7_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"6802c515_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"depends_on_list":[],"name":"8052b5ae_deployment","published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"AD_PACKAGE"}],"substrate_local_reference":{"kind":"app_substrate","name":"DomainController"},"min_replicas":"1","variable_list":[],"description":""}],"description":"","action_list":[{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Add User"},{"kind":"app_task","name":"UpdateService"}],"name":"f7430efe_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Add User"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"UpdateService"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"ActiveDirectory"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Add User","attrs":{"script":"$UserName = \"@@{AD_NAME}@@.@@{AD_SURNAME}@@\"\n\nAdd-ADGroupMember -Identity @@{AD_GROUP}@@ -Members $UserName","type":"","command_line_args":"","exit_status":[],"script_type":"npsscript"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"ActiveDirectory"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"UpdateService","attrs":{"exit_status":[],"script":"Write-Host AD_GROUPS = \"@@{AD_GROUP}@@,@@{AD_GROUPS}@@\"","eval_variables":["AD_GROUPS"],"eval_scope":"local","type":"","script_type":"npsscript"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]}],"description":"","name":"78fdcc54_runbook","main_task_local_reference":{"kind":"app_task","name":"f7430efe_dag"},"variable_list":[{"val_type":"STRING","description":"","name":"AD_GROUP","type":"LOCAL","value":"","label":"","attrs":{"type":""},"editables":{"value":true}}]},"name":"Add User to Group"}],"name":"Default","variable_list":[{"val_type":"STRING","description":"","name":"DC_ADDRESS","type":"LOCAL","value":"10.42.104.113","label":"","attrs":{"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"AD_NAME","type":"LOCAL","value":"John","label":"","attrs":{"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"AD_SURNAME","type":"LOCAL","value":"Smith","label":"","attrs":{"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"AD_PASSWORD","type":"SECRET","value":"","label":"","attrs":{"is_secret_modified":false,"secret_reference":{},"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"AD_EMAIL","type":"LOCAL","value":"john.smith@nutanix.com","label":"","attrs":{"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"AD_DOMAIN","type":"LOCAL","value":"calmers.local","label":"","attrs":{"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"AD_OU","type":"LOCAL","value":"CN=Users,DC=calmers,DC=local","label":"","attrs":{"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"AD_ADMIN","type":"LOCAL","value":"false","label":"","attrs":{"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"AD_ADMIN_GROUP","type":"LOCAL","value":"Domain Admins","label":"","attrs":{"type":""},"editables":{"value":true}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"calm_ad_svc_account"},"type":"USER"},"name":"GTSX2019-AD-CreateUser"},"api_version":"3.0","metadata":{"last_update_time":"1553705990010092","kind":"blueprint","spec_version":7,"creation_time":"1553705304162223","name":"GTSX2019-AD-CreateUser"}}